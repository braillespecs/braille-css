<?xml version="1.0" encoding="UTF-8"?>
<section id="paged-media">
  <h2> Paged Media </h2>
  <p class="issue">
    See <a href="https://github.com/snaekobbi/braille-css-spec/issues/28"
    class="ticket">braille-css-spec#28</a>.
  </p>
  <p>
    For producing braille on paper, the content of the document must be split into discrete
    pages. This process is called <dfn>pagination</dfn>. This specification defines properties
    for controlling the page dimensions, where pages may or must be broken, and for inserting
    content in page headers and footers.
  </p>
  <section id="page-boxes">
    <h3> Page Boxes </h3>
    <p>
      The <a href="CSS3PAGE#page-model">page model</a> [[CSS3PAGE]] specifies how a document is
      formatted within rectangular areas with a finite width and height, called <a
      href="CSS3PAGE#page-box" class="externalDFN">page boxes</a>, each consisting of a <a
      href="CSS3PAGE#page-area" class="externalDFN">page area</a> and up to 16 <a
      href="CSS3PAGE#page-margin-boxes" class="externalDFN">page-margin boxes</a>. Braille CSS
      has a slightly simplified model.
    </p>
    <p>
      In braille CSS, <a href="CSS3PAGE#page-box" class="externalDFN">page boxes</a> consist
      only of margin and content areas, no borders or padding. Moreover, page margins are used
      exclusively for creating page headers and footers, not for creating space between the
      content and the page edges. They cover at most one braille line. The <a
      href="CSS3PAGE#page-box" class="externalDFN">page box</a>'s top margin is ‘1’ when at
      least one of the 3 top margin boxes is generated, ‘0’ otherwise. Similarly, its bottom
      margin is ‘1’ when at least one of the 3 bottom margin boxes is generated.
    </p>
    <section id="the-page-rule">
      <h4> The ‘<a>@page</a>’ rule </h4>
      <p>
        The properties of a <a href="CSS3PAGE#page-box" class="externalDFN">page box</a>, such
        as its dimensions, are determined by properties declared within the <a
        href="CSS3PAGE#page-context" class="externalDFN">page context</a>, using ‘<a>@page</a>’
        rules.
      </p>
      <p>
        A ‘<dfn>@page</dfn>’ rule consists of the keyword ‘@page’, an optional <a
        href="CSS3PAGE#page-type-selector" class="externalDFN">page type selector</a> and a block of
        declarations and <a title="margin at-rule">margin at-rules</a> (said to be in the <a
        href="CSS3PAGE#page-context" class="externalDFN">page context</a>). The <a
        href="CSS3PAGE#page-type-selector" class="externalDFN">page type selector</a> matches pages
        of the <a title="named page">named page type</a> generated by the <a
        class="propname">page</a> property.
      </p>
      <p class="note">
        This rule differs from the original ‘<a href="CSS3PAGE#at-page-rule">@page</a>’ rule
        [[CSS3PAGE]] in that no <a href="CSS3PAGE#page-pseudo-class" class="externalDFN">page
        pseudo-classes</a> are allowed in the <a href="CSS3PAGE#page-selectors"
        class="externalDFN">page selector</a>, and that only the <a class="propname">size</a>
        property is allowed in declarations.
      </p>
    </section>
    <section id="the-size-property">
      <h4> Page Size: the <a class="propname">size</a> property </h4>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>size</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td><a><var>&lt;length&gt;</var></a>{2} | auto</td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td>auto</td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td><a href="CSS3PAGE#page-context" class="externalDFN">page context</a></td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td>N/A</td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td>
              the <a href="CSS3CASCADE#specified" class="externalDFN">specified value</a>
            </td>
          </tr>
        </tbody>
      </table>
      <p>
        The <a class="propname">size</a> property specifies the size of the <a
        href="CSS3PAGE#page-box" class="externalDFN">page box</a>'s containing block. Values have
        the following meanings:
      </p>
      <dl>
        <dt> auto </dt>
        <dd>
          The <a href="CSS3PAGE#page-box" class="externalDFN">page box</a> will be set to a size
          by the <a href="CSS2CONFORM#user-agent" class="externalDFN">user agent</a>. In the
          usual case, the size is chosen to match the <a href="CSS3PAGE#printable-area"
          class="externalDFN">printable area</a> of the target <a href="CSS3PAGE#page-sheet"
          class="externalDFN">page sheet</a>.
        </dd>
        <dt>
          <a>&lt;length&gt;</a>{2}
        </dt>
        <dd>
          The <a href="CSS3PAGE#page-box" class="externalDFN">page box</a> will be set to the
          given dimensions. The first value establishes the <a href="CSS3PAGE#page-box"
          class="externalDFN">page box</a> width, and the second the <a href="CSS3PAGE#page-box"
          class="externalDFN">page box</a> height. Negative lengths are illegal.
        </dd>
      </dl>
      <p class="note">
        This property differs from the original <a href="CSS3PAGE#size" class="externalDFN
        propname">size</a> property [[CSS3PAGE]] in that it doesn't specify the orientation of the
        <a href="CSS3PAGE#page-box" class="externalDFN">page box</a>, and that no other values than
        <span class="propval">auto</span> and <a title="&lt;length&gt;">lengths</a> are allowed.
      </p>
      <p class="note">
        Note that while in the original specification the <a class="propname">size</a> property is
        meant to match the size of the <a href="CSS3PAGE#page-sheet" class="externalDFN">page
        sheet</a>, in braille CSS it is meant to match the area on which will eventually be
        printed. Page margins are only used for creating page headers and footers, not for creating
        white space between the content and the page edges.
      </p>
    </section>
    <section id="page-margin-boxes">
      <h4> Page-Margin Boxes </h4>
      <p>
        <a href="CSS3PAGE#page-margin-boxes" class="externalDFN">Page-margin boxes</a> are boxes
        within the page margin that can contain <a href="#generated-content">generated
        content</a>. Page margins can be used to create page headers and footers, which are
        portions of the page set aside for supplementary information such as the page number or
        document title. The 16 <a href="CSS3PAGE#margin-box-def">page-margin boxes</a> are
        defined and illustrated in [[CSS3PAGE]].
      </p>
      <p>
        Only 6 of the 16 <a href="CSS3PAGE#page-margin-boxes" class="externalDFN">page-margin
        boxes</a> are relevant in braille CSS, namely <a href="CSS3PAGE#top-left-box-def"
        class="externalDFN">top-left</a>, <a href="CSS3PAGE#top-center-box-def"
        class="externalDFN">top-center</a>, <a href="CSS3PAGE#top-right-box-def"
        class="externalDFN">top-right</a>, <a href="CSS3PAGE#bottom-left-box-def"
        class="externalDFN">bottom-left</a>, <a href="CSS3PAGE#bottom-center-box-def"
        class="externalDFN">bottom-center</a> and <a href="CSS3PAGE#bottom-right-box-def"
        class="externalDFN">bottom-right</a>.
      </p>
      <p>
        <a href="CSS3PAGE#page-margin-boxes" class="externalDFN">Page-margin boxes</a> are
        created by <a title="margin at-rule">margin at-rules</a> inside the <a
        href="CSS3PAGE#page-context" class="externalDFN">page context</a>.
      </p>
      <p>
        A <dfn>margin at-rule</dfn> consists of an <a
        href="CSS3PAGE#specializatons-of-ATKEYWORD" class="externalDFN">ATKEYWORD</a> that
        identifies the <a href="CSS3PAGE#page-margin-boxes" class="externalDFN">page-margin
        box</a> (e.g. ‘@top-left’) and a block of declaractions (said to be in the <a
        href="CSS3PAGE#margin-context" class="externalDFN">margin context</a>).
      </p>
      <p class="note">
        This rules differs from the original ‘<a href="CSS3PAGE#margin-at-rule"
        class="externalDFN">margin at-rule</a>’ [[CSS3PAGE]] in that only the <a
        class="propname">content</a> property is allowed in declarations.
      </p>
      <p>
        A <a href="CSS3PAGE#page-margin-boxes" class="externalDFN">page-margin box</a> is generated
        if and only if the <a href="CSS3CASCADE#computed" class="externalDFN">computed value</a> of
        its <a class="propname">content</a> property is not <span class="propval">none</span>.
      </p>
    </section>
    <section id="the-page-property">
      <h4> Using Named Pages: the <a class="propname">page</a> property </h4>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>page</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td>
              auto | <a href="CSS3VAL#identifier-value"
              class="externalDFN"><var>&lt;custom-ident&gt;</var></a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td>auto</td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td><a>block</a> | <a>list-item</a></td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td>no (see text)</td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td>
              the <a href="CSS3CASCADE#specified" class="externalDFN">specified value</a>
            </td>
          </tr>
        </tbody>
      </table>
      <p>
        The <a class="propname">page</a> property is used to specify a particular type of page
        (called a <dfn>named page</dfn>) on which an element <em>must</em> be displayed. If
        necessary, a forced page break is introduced and a new page generated of the specified
        type. The page can be styled by using the same type name in a <a
        href="CSS3PAGE#page-selectors" class="externalDFN">page selector</a>.
      </p>
      <p>
        The <a class="propname">page</a> property does not inherit. However, if the <a
        class="propname">page</a> value on an element is <span class="propval">auto</span>, then its
        <a href="CSS3CASCADE#used" class="externalDFN">used value</a> is the value specified on its
        nearest <a href="CSS2CONFORM#ancestor" class="externalDFN">ancestor</a> with a non-<span
        class="propval">auto</span> value. When specified on the root element, the <a
        href="CSS3CASCADE#used" class="externalDFN">used value</a> for <span
        class="propval">auto</span> is the empty string.
      </p>
    </section>
  </section>
  <section id="page-breaking">
    <h3> Page Breaking </h3>
    <p>
      In order to avoid awkward breaks, the layout engine must be able to shift around content
      that would fall across the page break. The CSS Fragmentation [[CSS3BREAK]] module defines
      how and where CSS boxes can be fragmented, including across page breaks. It defines
      properties for indicating where pages may or must be broken, and on what page (left or
      right) the subsequent content resumes.
    </p>
    <p class="note">
      The generic term for breaking content across containers is <a
      href="CSS3BREAK#fragmentation" class="externalDFN">fragmentation</a>, and the containers
      are called <a href="CSS3BREAK#fragmentainer" class="externalDFN">fragmentainers</a>. <a
      title="volume">Volumes</a> are another example of fragmentainers.
    </p>
    <section id="controlling-page-breaks">
      <h4>
        Controlling Page Breaks: the <a class="propname">page-break-before</a>, <a
        class="propname">page-break-after</a>, <a class="propname">page-break-inside</a>, <a
        class="propname">orphans</a> and <a class="propname">widows</a> properties
      </h4>
      <p>
        A page break opportunity between two boxes is under the influence of the containing block's
        <a class="propname">page-break-inside</a> property, the <a
        class="propname">page-break-after</a> property of the <a href="CSS2CONFORM#preceding"
        class="externalDFN">preceding element</a>, and the <a class="propname">page-break-before</a>
        property of the <a href="CSS2CONFORM#following" class="externalDFN">following element</a>. A
        page break opportunity between <a title="line box">line boxes</a> is under the influence of
        the containing block's <a class="propname">widows</a> and <a class="propname">orphans</a>
        properties. A break can be allowed, forced, or discouraged depending on the values of these
        properties. See the section <a href="#page-breaking-rules">Rules for Page Breaking</a> below
        for the exact rules on how these properties affect page breaking.
      </p>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>page-break-before</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td> auto | always | avoid | left | right </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td> auto </td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td> block | list-item </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td> no </td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td> specified value </td>
          </tr>
        </tbody>
      </table>
      <p class="issue">
        avoid | left is currently not supported in the Liblouis based implementation.
      </p>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>page-break-after</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td> auto | always | avoid | left | right </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td> auto </td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td> block | list-item </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td> no </td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td> specified value </td>
          </tr>
        </tbody>
      </table>
      <p class="issue">
        left | right is currently not supported in the Liblouis based implementation.
      </p>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>page-break-inside</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td> auto | avoid </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td> auto </td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td> block | list-item </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td> no </td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td> specified value </td>
          </tr>
        </tbody>
      </table>
      <p>
        These properties control page break behaviour before, after and within the element's
        principle box. Values have the following meanings:
      </p>
      <dl>
        <dt>auto</dt>
        <dd>
          Neither force nor forbid a page break before/after/inside the principle box.
        </dd>
        <dt>always</dt>
        <dd>
          Always force a page break before/after the principle box.
        </dd>
        <dt>avoid</dt>
        <dd>
          Avoid a page break before/after/inside the principle box.
        </dd>
        <dt>left</dt>
        <dd>
          Force one or two page breaks before/after the principle box so that the next page is
          formatted as a left page.
        </dd>
        <dt>right</dt>
        <dd>
          Force one or two page breaks before/after the principle box so that the next page is
          formatted as a right page.
        </dd>
      </dl>
      <p>
        Since breaks are allowed between siblings, but not between a box and its container (see <a
        href="#page-breaking-rules">Rules for Page Breaking</a>), a <a
        class="propname">page-break-before</a> value on a first-child box is propagated to its
        container. Likewise a <a class="propname">page-break-after</a> value on a last-child box is
        propagated to its container.
      </p>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>orphans</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td>
              <a class="externalDFN"
                 href="http://www.w3.org/TR/css3-syntax/#typedef-integer"><var>&lt;integer&gt;</var></a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td> 0</td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td> block | list-item </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td> no </td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td> specified value </td>
          </tr>
        </tbody>
      </table>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>widows</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td> <a class="externalDFN"
                    href="http://www.w3.org/TR/css3-syntax/#typedef-integer"><var>&lt;integer&gt;</var></a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td> 0 </td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td> block | list-item </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td> no </td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td> specified value </td>
          </tr>
        </tbody>
      </table>
      <p>
        The <a class="propname">orphans</a> property specifies the minimum number of <a title="line
        box">line boxes</a> in a block container that must be left in a <a href="CSS3BREAK#fragment"
        class="externalDFN">fragment</a> before a page break. The <a class="propname">widows</a>
        property specifies the minimum number of <a title="line box">line boxes</a> of a block
        container that must be left in a <a href="CSS3BREAK#fragment"
        class="externalDFN">fragment</a> after a page break. Only positive integers are allowed. If
        a block contains fewer lines than the value of <a class="propname">widows</a> or <a
        class="propname">orphans</a>, the rule simply becomes that all lines in the block must be
        kept together.
      </p>
      <p class="issue">
        <a>widows</a> is currently not supported in the Liblouis based implementation. See <a
        href="https://github.com/daisy/pipeline-mod-braille/issues/13"
        class="ticket">pipeline-mod-braille#13</a>.
      </p>
    </section>
    <section id="page-breaking-rules">
      <h4> Rules for Page Breaking </h4>
      <p>
        A flow may be broken across pages at a number of possible break points. In the case of
        <a class="externalDFN" href="CSS3BREAK#forced-breaks">forced breaks</a>, the UA is
        required to break the flow at that point. In the case of <a class="externalDFN"
        href="CSS3BREAK#unforced-breaks">unforced breaks</a> the UA has to choose among the
        possible breaks that are allowed. Page breaks can occur between sibling block-level
        boxes (<a href="CSS3BREAK#btw-blocks" class="externalDFN">class A break point</a>), or
        between <a title="line box">line boxes</a> inside a block container box (<a
        href="CSS3BREAK#btw-lines" class="externalDFN">class B break point</a>).
      </p>
      <p>
        A <a class="externalDFN" href="CSS3BREAK#forced-breaks">forced page break</a> occurs at a <a
        href="CSS3BREAK#btw-blocks" class="externalDFN">class A break point</a> if, among the <a
        class="propname">page-break-after</a> and <a class="propname">page-break-before</a>
        properties of all the elements generating boxes that meet at this margin, there is at least
        one with a <a class="externalDFN" href="CSS3BREAK#forced-break-values">forced break
        value</a> (<span class="propval">always</span>, <span class="propval">left</span>, or <span
        class="propval">right</span>). A forced break takes precedence over any break restrictions
        acting at that point.
      </p>
      <p>
        A <a class="externalDFN" href="CSS3BREAK#forced-breaks">forced page break</a> also
        occurs at a <a href="CSS3BREAK#btw-blocks" class="externalDFN">class A break point</a>
        if the last line box above this margin and the first one below it do not have the same
        value for <a class="propname">page</a>.
      </p>
      <p>
        <a class="externalDFN" href="CSS3BREAK#unforced-breaks">Unforced page breaks</a> are
        inserted automatically in order to prevent content from overflowing the page. The
        following rules control whether unforced breaking at a break point opportunity is
        allowed:
      </p>
      <ol>
        <li>
          A page may be broken at a <a href="CSS3BREAK#btw-blocks" class="externalDFN">class A break
          point</a> only if the <a class="propname">page-break-after</a> and <a
          class="propname">page-break-before</a> values applicable to this break point allow it,
          which is when at least one of them forces a break or when all of them are <span
          class="propval">auto</span>.
        </li>
        <li>
          However, if all of them are <span class="propval">auto</span> and a common ancestor of all
          the elements has a <a class="propname">page-break-inside</a> value of <span
          class="propval">avoid</span>, then breaking here is not allowed.
        </li>
        <li>
          Breaking at a <a href="CSS3BREAK#btw-lines" class="externalDFN">class B break point</a> is
          allowed only if the number of line boxes between the break and the start of the enclosing
          block box is the value of <a class="propname">orphans</a> or more, and the number of line
          boxes between the break and the end of the box is the value of <a
          class="propname">widows</a> or more.
        </li>
        <li>
          Additionally, breaking at a <a href="CSS3BREAK#btw-lines" class="externalDFN">class B
          break point</a> is allowed only if the <a class="propname">page-break-inside</a> property
          of all ancestors is <span class="propval">auto</span>.
        </li>
      </ol>
      <p>
        If the above doesn't provide enough break points to keep content from overflowing the
        page, then rules 1, 2 and 4 are dropped in order to find additional break points. If
        that still does not lead to sufficient break points, rule 3 is dropped as well.
      </p>
      <p class="note">
        Note that these rules only define where breaking is allowed, and while this
        specification requires that content does not overflow the page, it does not impose any
        particular algorithm for determining the exact break points.
      </p>
    </section>
  </section>
</section>
