<?xml version="1.0" encoding="UTF-8"?>
<section id="volumes">
  <h2> Volumes </h2>
  <p>
    When producing braille on paper, a document may need to be split into several so called <a
    title="volume">volumes</a> due to size limits on paper books. <a title="volume">Volumes</a>
    are the physical units (books) that make up the complete work. This specification defines
    properties for controlling the size of volumes, where volumes may or must be broken, and for
    inserting content at the beginning or end of specific volumes.
  </p>
  <section id="the-volume-rule">
    <h3> The <a class="css">@volume</a> rule </h3>
    <p>
      The properties of a volume, such as its dimensions, are determined by CSS properties
      declared within the <a>volume context</a>, using <a class="css">@volume</a> rules.
    </p>
    <p>
      A <dfn class="css">@volume</dfn> rule consists of the keyword <span
      class="css">@volume</span>, an optional <a>volume selector</a>, and a block of declarations
      and at-rules (said to be in the <dfn>volume context</dfn>). A <dfn>volume selector</dfn> is
      made of either a <a>volume type selector</a>, a <a>volume pseudo-class</a>, or a type selector
      followed by a pseudo-class. A volume selector matches a given volume if and only if all of its
      components match the volume. A <dfn>volume type selector</dfn> is a CSS <a class="externalDFN"
      href="CSS3VAL#identifier">identifier</a> and matches volumes of the <a title="named
      volume">named volume type</a> generated by the <a title="volume property"
      class="css-propname">volume</a> property. The <dfn title="volume pseudo-class">volume
      pseudo-classes</dfn> <span class="css">:first</span>, <span class="css">:last</span> and <span
      class="css">:nth(<var>&lt;n&gt;</var>)</span> match the first, last and <var>n</var>th
      volume. If the pseudo-class follows a <a>volume type selector</a>, it matches the first, last
      or <var>n</var>th volume in a sequence of volumes of the specified type.
    </p>
  </section>
  <section id="the-length-properties">
    <h3>
      Volume Size: the <a class="css-propname">min-length</a> and <a class="css-propname">max-length</a>
      properties
    </h3>
    <table class="propdef">
      <tbody>
        <tr>
          <th>Name:</th>
          <td><dfn>min-length</dfn></td>
        </tr>
        <tr>
          <th>Value:</th>
          <td>
            <a class="externalDFN"
            href="http://www.w3.org/TR/css3-syntax/#typedef-integer"><var>&lt;integer&gt;</var></a>
            | auto
          </td>
        </tr>
        <tr>
          <th>
            <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
          </th>
          <td>auto</td>
        </tr>
        <tr>
          <th>Applies to:</th>
          <td><a>volume context</a></td>
        </tr>
        <tr>
          <th>
            <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
          </th>
          <td>N/A</td>
        </tr>
        <tr>
          <th>Media:</th>
          <td>
            <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
          </td>
        </tr>
        <tr>
          <th>
            <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
          </th>
          <td>
            the <a href="CSS3CASCADE#specified" class="externalDFN">specified value</a>
          </td>
        </tr>
      </tbody>
    </table>
    <table class="propdef">
      <tbody>
        <tr>
          <th>Name:</th>
          <td><dfn>max-length</dfn></td>
        </tr>
        <tr>
          <th>Value:</th>
          <td>
            <a class="externalDFN"
               href="http://www.w3.org/TR/css3-syntax/#typedef-integer"><var>&lt;integer&gt;</var></a>
            | auto
          </td>
        </tr>
        <tr>
          <th>
            <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
          </th>
          <td>auto</td>
        </tr>
        <tr>
          <th>Applies to:</th>
          <td><a>volume context</a></td>
        </tr>
        <tr>
          <th>
            <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
          </th>
          <td>N/A</td>
        </tr>
        <tr>
          <th>Media:</th>
          <td>
            <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
          </td>
        </tr>
        <tr>
          <th>
            <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
          </th>
          <td>
            the <a href="CSS3CASCADE#specified" class="externalDFN">specified value</a>
          </td>
        </tr>
      </tbody>
    </table>
    <p>
      The <a class="css-propname">min-length</a> and <a class="css-propname">max-length</a> properties
      specify the minimum and maximum allowed lengths of a volume in terms of pages. Negative
      lengths are illegal. The value <span class="css-propval">auto</span> means that no lower/upper
      constraint is set on the volume size. When <a class="css-propname">max-length</a> is <span
      class="css-propval">auto</span> and there are no <a title="forced volume break">forced volume
      breaks</a>, the document must consist of a single volume.
    </p>
  </section>
  <section id="the-begin-and-end-rules">
    <h3> Volume Areas: the <a class="css">@begin</a> and <a class="css">@end</a> rules </h3>
    <p>
      Volume areas are boxes at the beginning and end of volumes that can contain <a
      href="#generated-content">generated content</a>. They are created by <a class="css">@begin</a>
      and <a class="css">@end</a> rules inside the <a>volume context</a>.
    </p>
    <p>
      A <dfn class="css">@begin</dfn> rule consists of the keyword <span class="css">@begin</span>
      followed by a block of declarations. An <dfn class="css">@end</dfn> rule consists of the
      keyword <span class="css">@end</span> and a block of declarations.
    </p>
    <p>
      A volume area box is generated if and only if the <a href="CSS3CASCADE#computed"
      class="externalDFN">computed value</a> of its <a class="css-propname">content</a> property is not
      <span class="css-propval">none</span>.
    </p>
  </section>
  <section id="the-volume-propery">
    <h3>
      Using Named Volumes : the <a title="volume property" class="css-propname">volume</a> property
    </h3>
    <table class="propdef">
      <tbody>
        <tr>
          <th>Name:</th>
          <td> <dfn title="volume property">volume</dfn ></td>
        </tr>
        <tr>
          <th>Value:</th>
          <td>
            auto | <a href="CSS3VAL#identifier-value"
            class="externalDFN"><var>&lt;custom-ident&gt;</var></a>
          </td>
        </tr>
        <tr>
          <th>
            <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
          </th>
          <td>auto</td>
        </tr>
        <tr>
          <th>Applies to:</th>
          <td><a>block</a> | <a>list-item</a></td>
        </tr>
        <tr>
          <th>
            <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
          </th>
          <td>no (see text)</td>
        </tr>
        <tr>
          <th>Media:</th>
          <td>
            <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
          </td>
        </tr>
        <tr>
          <th>
            <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
          </th>
          <td>
            the <a href="CSS3CASCADE#specified" class="externalDFN">specified value</a>
          </td>
        </tr>
      </tbody>
    </table>
    <p>
      The <a title="volume property" class="css-propname">volume</a> property is used to specify a
      particular type of volume (called a <dfn>named volume</dfn>) on which an element must be
      displayed. If necessary, a <a>forced volume break</a> is introduced.
    </p>
    <p>
      The <a title="volume property" class="css-propname">volume</a> property does not inherit. However,
      if the <a title="volume property" class="css-propname">volume</a> value on an element is <span
      class="css-propval">auto</span>, then its <a href="CSS3CASCADE#used" class="externalDFN">used
      value</a> is the value specified on its nearest <a href="CSS2CONFORM#ancestor"
      class="externalDFN">ancestor</a> with a non-<span class="css-propval">auto</span> value. When
      specified on the <a href="CSS2CONFORM#root" class="externalDFN">root element</a>, the <a
      href="CSS3CASCADE#used" class="externalDFN">used value</a> for <span
      class="css-propval">auto</span> is the empty string.
    </p>
  </section>
  <section id="volume-breaking">
    <h3> Volume Breaking </h3>
    <p class="issue">
      See <a href="https://github.com/snaekobbi/braille-css-spec/issues/3"
      class="ticket">braille-css-spec#3</a>.
    </p>
    <p>
      In order to avoid awkward volume breaks (for instance, in the middle of a sentence, or after
      the first paragraph of a chapter), volumes sometimes need to be broken before the <a
      title="max-length">upper page bound</a> has been reached. This specification defines
      properties for indicating where volumes may or must be broken. Breaks at certain places may be
      forced, encouraged or discouraged.
    </p>
    <section id="controlling-volume-breaks">
      <h4>
        Controlling Volume Breaks: the <a class="css-propname">volume-break-before</a>, <a
        class="css-propname">volume-break-after</a> and <a class="css-propname">volume-break-inside</a>
        properties
      </h4>
      <p>
        A volume break opportunity between two boxes is under the influence of the containing
        block's <a class="css-propname">volume-break-inside</a> property, the <a
        class="css-propname">volume-break-after</a> property of the <a href="CSS2CONFORM#preceding"
        class="externalDFN">preceding element</a>, and the <a
        class="css-propname">volume-break-before</a> property of the <a href="CSS2CONFORM#following"
        class="externalDFN">following element</a>. See the section <a
        href="#volume-breaking-rules">Rules for Volume Breaking</a> below for the exact rules on how
        these properties affect volume breaking.
      </p>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>volume-break-before</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td> auto | always | avoid | prefer </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td> auto </td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td> block | list-item </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td> no </td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td> specified value </td>
          </tr>
        </tbody>
      </table>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>volume-break-after</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td> auto | always | avoid | prefer </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td> auto </td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td> block | list-item </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td> no </td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td> specified value </td>
          </tr>
        </tbody>
      </table>
      <table class="propdef">
        <tbody>
          <tr>
            <th>Name:</th>
            <td><dfn>volume-break-inside</dfn></td>
          </tr>
          <tr>
            <th>Value:</th>
            <td> auto | avoid </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#initial-value" class="externalDFN">Initial</a>:
            </th>
            <td> auto </td>
          </tr>
          <tr>
            <th>Applies to:</th>
            <td> block | list-item </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#inherited-property" class="externalDFN">Inherited</a>:
            </th>
            <td> no </td>
          </tr>
          <tr>
            <th>Media:</th>
            <td>
              <a href="CSS2MEDIA#media-types" class="externalDFN">embossed</a>
            </td>
          </tr>
          <tr>
            <th>
              <a href="CSS3CASCADE#computed" class="externalDFN">Computed value</a>:
            </th>
            <td> specified value </td>
          </tr>
        </tbody>
      </table>
      <p>
        These properties control volume break behaviour before, after and within the element's
        principle box. Values have the following meanings:
      </p>
      <dl>
        <dt>auto</dt>
        <dd>
          Neither force nor forbid nor encourage a volume break before/after/inside the principle
          box.
        </dd>
        <dt>always</dt>
        <dd>
          Always force a volume break before/after the principle box.
        </dd>
        <dt>prefer</dt>
        <dd>
          Encourage a volume break before/after the principle box
        </dd>
        <dt>avoid</dt>
        <dd>
          Avoid a volume break before/after/inside the principle box.
        </dd>
      </dl>
      <p>
        Since breaks are allowed between siblings, but not between a box and its container (see <a
        href="#volume-breaking-rules">Rules for Volume Breaking</a>), a <a
        class="css-propname">volume-break-before</a> value on a first-child box is propagated to its
        container. Likewise a <a class="css-propname">volume-break-after</a> value on a last-child box
        is propagated to its container.
      </p>
    </section>
    <section id="volume-breaking-rules">
      <h4>
        Rules for Volume Breaking
      </h4>
      <p>
        A flow may be broken across volumes at a number of possible break points. In the case of <a
        title="forced volume break">forced breaks</a>, the UA is required to break the flow at that
        point. In the case of <a title="unforced volume break">unforced breaks</a> the UA has to
        choose among the possible breaks that are allowed. Volume breaks can occur between sibling
        block-level boxes (<a href="CSS3BREAK#btw-blocks" class="externalDFN">class A break
        point</a>), or between <a title="line box">line boxes</a> inside a block container box (<a
        href="CSS3BREAK#btw-lines" class="externalDFN">class B break point</a>).
      </p>
      <p>
        A <dfn>forced volume break</dfn> occurs at a <a href="CSS3BREAK#btw-blocks"
        class="externalDFN">class A break point</a> if, among the <a
        class="css-propname">volume-break-after</a> and <a class="css-propname">volume-break-before</a>
        properties of all the elements generating boxes that meet at this margin, there is at least
        one with a <a class="externalDFN" href="CSS3BREAK#forced-break-values">forced break
        value</a> (<span class="css-propval">always</span>). A forced break takes precedence over any
        break restrictions acting at that point.
      </p>
      <p>
        A <a>forced volume break</a> also occurs at a <a href="CSS3BREAK#btw-blocks"
        class="externalDFN">class A break point</a> if the last line box above this margin and the
        first one below it do not have the same value for <a class="css-propname">volume</a>.
      </p>
      <p>
        <dfn title="unforced volume break">Unforced volume breaks</dfn> are inserted automatically
        in order to meet the <a class="css-propname">max-length</a> constraints. The following rules
        control whether unforced breaking at a break point opportunity is allowed:
      </p>
      <ol>
        <li>
          A volume may be broken at a <a href="CSS3BREAK#btw-blocks" class="externalDFN">class A
          break point</a> only if the <a class="css-propname">volume-break-after</a> and <a
          class="css-propname">volume-break-before</a> values applicable to this break point allow it,
          which is when at least one of them forces a break or when none of them are <span
          class="css-propval">avoid</span>.
        </li>
        <li>
          However, if none of them force a break and a common ancestor of all the elements has a <a
          class="css-propname">volume-break-inside</a> value of <span class="css-propval">avoid</span>, then
          breaking here is not allowed.
        </li>
        <li>
          Breaking at a <a href="CSS3BREAK#btw-lines" class="externalDFN">class B break point</a> is
          allowed only if the <a class="css-propname">volume-break-inside</a> property of all ancestors
          is <span class="css-propval">auto</span>.
        </li>
      </ol>
      <p>
        If the above doesn't provide enough break points, the UA may break anywhere in order to
        avoid violating the <a class="css-propname">max-length</a> constraints.
      </p>
      <p>
        In the end, all <a class="css-propname">min-length</a> constraints must be met as well, unless a
        volume being to short is the result of <a title="forced volume break">forced volume
        breaks</a>.
      </p>
      <p class="note">
        Note that these rules only define where breaking is allowed. The specification does not
        impose any particular algorithm for determining the exact break points.
      </p>
    </section>
  </section>
</section>
    
